# ğŸš¦ Tema 6: Routers â€“ Dirigiendo el Flujo del Grafo  

## ğŸš€ Â¿QuÃ© es un Router en LangGraph?  

Los **routers** en LangGraph son nodos especiales que permiten **redirigir el flujo hacia diferentes caminos** en funciÃ³n de condiciones dinÃ¡micas.  
A diferencia de los **edges condicionales**, los routers **centralizan y gestionan mÃºltiples bifurcaciones** desde un solo punto, haciendo que los grafos sean mÃ¡s **modulares, limpios y escalables.**  

---

### ğŸ§  Â¿Por quÃ© usar Routers en lugar de Condicionales?  

- **CentralizaciÃ³n:** Un solo nodo puede gestionar mÃºltiples caminos, evitando bifurcaciones dispersas.  
- **Escalabilidad:** A medida que crecen los caminos posibles, los routers permiten expandir el grafo sin aÃ±adir complejidad.  
- **ReutilizaciÃ³n:** Un mismo router puede ser usado en **diferentes partes del grafo.**  
- **Legibilidad:** Mantiene el grafo **organizado y fÃ¡cil de seguir.**  

ğŸ‘‰ **Piensa en el router como un semÃ¡foro** ğŸš¦ que dirige el trÃ¡fico hacia diferentes carriles en funciÃ³n de las seÃ±ales recibidas.  

---

## âš™ï¸ Â¿CÃ³mo Funciona un Router?  

Un router funciona tomando una **decisiÃ³n basada en el estado del grafo** o en **parÃ¡metros especÃ­ficos de entrada.**  
Define mÃºltiples caminos posibles y selecciona uno, enviando el flujo hacia el nodo correspondiente.  

---

## ğŸ“‹ Ejemplo PrÃ¡ctico: Chatbot con Router de Departamentos  

Vamos a crear un chatbot que redirige al usuario a diferentes departamentos segÃºn el tipo de pregunta:  

1. **Soporte TÃ©cnico:** Para resolver problemas tÃ©cnicos.  
2. **Ventas:** Para consultas de productos o servicios.  
3. **Consultas Generales:** Para cualquier otra pregunta.  

El router analizarÃ¡ el mensaje del usuario y lo dirigirÃ¡ al nodo adecuado.  

```python
from typing_extensions import TypedDict

class State(TypedDict):
    message: str
    response: str

def user_input(state: State):
    print("--- Nodo 1: Entrada del Usuario ---")
    state["message"] = "Quiero comprar un producto"
    return state

def route_request(state: State) -> str:
    message = state["message"].lower()
    if "soporte" in message or "problema" in message:
        return "support_node"
    elif "comprar" in message or "precio" in message:
        return "sales_node"
    else:
        return "general_node"

def support_node(state: State):
    print("--- Nodo de Soporte TÃ©cnico ---")
    state["response"] = "Te estamos transfiriendo a soporte tÃ©cnico."
    return state

def sales_node(state: State):
    print("--- Nodo de Ventas ---")
    state["response"] = "Te conectamos con el equipo de ventas."
    return state

def general_node(state: State):
    print("--- Nodo de Consultas Generales ---")
    state["response"] = "Tu consulta serÃ¡ respondida a la brevedad."
    return state
``` 

---

### ğŸ” ExplicaciÃ³n del Ejemplo:  

- **Nodo 1 (user_input):** Recibe el mensaje del usuario.  
- **Router (route_request):** EvalÃºa el mensaje y redirige al nodo correspondiente: `support_node`, `sales_node` o `general_node`.  
- **Nodos de Respuesta:** Cada nodo proporciona una respuesta basada en el departamento al que se redirigiÃ³ al usuario.  

---

## ğŸ—ï¸ ConstrucciÃ³n del Grafo con Router  

Agregamos el router y conectamos cada nodo de respuesta al flujo.  
```python
from langgraph.graph import StateGraph, START, END

builder = StateGraph(State)
builder.add_node("user_input", user_input)
builder.add_node("route_request", route_request)
builder.add_node("support_node", support_node)
builder.add_node("sales_node", sales_node)
builder.add_node("general_node", general_node)

builder.add_edge(START, "user_input")
builder.add_conditional_edges("user_input", route_request)
builder.add_edge("support_node", END)
builder.add_edge("sales_node", END)
builder.add_edge("general_node", END)

graph = builder.compile()
```

---

## ğŸš€ Invocando el Grafo  

Probamos el grafo con diferentes entradas para ver cÃ³mo el router dirige el flujo.  
```python
graph.invoke({"message": "", "response": ""})
```

```python title="Resultado"
--- Nodo 1: Entrada del Usuario ---
--- Nodo de Ventas ---
{'message': 'Quiero comprar un producto', 'response': 'Te conectamos con el equipo de ventas.'}
```

Dependiendo del contenido del mensaje del usuario, el flujo tomarÃ¡ caminos distintos, demostrando el poder y flexibilidad de los routers.  

---

## ğŸ§‘â€ğŸ« Â¿QuÃ© Hemos Aprendido?  

- **Routers:** Son nodos que gestionan mÃºltiples bifurcaciones desde un solo punto.  
- **CentralizaciÃ³n y Escalabilidad:** Los routers permiten mantener un grafo limpio y organizado, facilitando la expansiÃ³n.  
- **Flujos DinÃ¡micos:** Los routers toman decisiones en tiempo real basadas en el estado o entrada del usuario.  

---

## ğŸŒ Â¿QuÃ© es lo Siguiente?  

En el prÃ³ximo tema, hablaremos de **Reducers**, que permiten consolidar datos y resultados de diferentes caminos dentro del grafo.  
Los reducers trabajan en conjunto con los routers, formando flujos completos y optimizados.  
