# 🧩 Tema 3: State Schema

## 🚀 ¿Qué es el State Schema?  

El **State Schema** en LangGraph define la estructura de datos que viaja a través de un grafo durante su ejecución.  
Es como el “ADN” del flujo, que **transporta y actualiza información** a medida que se avanza por diferentes nodos. 
Piensa en el estado como una mochila 🧳 que lleva datos entre los nodos. 

### 🧠 ¿Por qué es importante?  
El State Schema permite:  
- **Controlar y validar los datos** que circulan por el grafo.  
- **Definir tipos de datos específicos** (texto, listas, enteros, etc.) para evitar errores.  
- **Modificar y actualizar atributos** a lo largo del flujo.  

Imagina que estás construyendo un asistente virtual:  
- El State podría contener atributos como el nombre del usuario, historial de mensajes y preferencias.  
- A medida que la conversación avanza, los nodos modifican o consultan estos atributos.  

---

## ⚙️ ¿Cómo se Define el State Schema?  

Para definir un `State` personalizado, utilizamos `TypedDict`. Esto nos permite crear una plantilla de estado con atributos específicos y sus respectivos tipos.  

### 📋 Ejemplo: Creación de un State con Varios Atributos  
[codigo1]  

---

### 🧩 Explicación:  
- **`TypedDict`** crea una plantilla para el estado.  
- **`name` y `age`** son atributos que definen el nombre y edad de un usuario.  
- **`preferences`** es una lista que guarda intereses o preferencias.  

Con esto, aseguramos que el estado tenga una estructura clara y solo acepte los tipos de datos definidos.  

---

## 🔄 ¿Cómo Funciona el State en un Grafo?  

El `State` fluye de un nodo a otro, llevando consigo información que puede **ser modificada, eliminada o ampliada**.  
Cada nodo puede:  
- **Leer atributos** del estado.  
- **Modificar datos existentes.**  
- **Agregar nuevos atributos** si es necesario.  

Esto nos permite construir flujos dinámicos y adaptativos, donde el grafo evoluciona según las interacciones del usuario o los cálculos realizados.  

---

## 🛠️ Ejemplo Completo con Nodos  

Vamos a construir un grafo que:  
1. Reciba el nombre y edad del usuario.  
2. Modifique el estado agregando una preferencia de acuerdo con la edad.  

---

### 📋 Definiendo Nodos para Modificar el Estado  
[codigo2]  

- **Nodo `user_input_node`**: Toma el nombre y la edad del usuario y los añade al estado.  
- **Nodo `recommendation_node`**: Agrega recomendaciones basadas en la edad del usuario.  

---

### 🏗️ Construcción del Grafo  
[codigo3]  

Explicación de cada paso:  
1. **Creamos el grafo con `StateGraph`.**  
2. **Añadimos los nodos.**  
3. **Definimos el flujo:**  
   - El grafo comienza en `START` y pasa por `user_input_node`.  
   - Luego se dirige a `recommendation_node` antes de finalizar (`END`).  

---

## 🚀 Invocando el Grafo y Resultados  

### Ejecución del Grafo  
[codigo4]  

---

### 📊 Resultados Esperados  
[resultado1]  

- Si el usuario tiene menos de 18 años, el grafo recomienda videojuegos.  
- Si tiene 18 o más, se recomienda programación.  

---

## 🧑‍🏫 ¿Qué Hemos Aprendido?  

- **State Schema:** Define la estructura de datos que viaja por el grafo.  
- **TypedDict:** Permite definir el esquema con tipos específicos, asegurando que el estado tenga una estructura clara y validada.  
- **Nodos y Estado:** Los nodos pueden modificar y ampliar el estado, creando flujos dinámicos.  

---

## 🌐 ¿Qué es lo Siguiente?  

En el próximo tema, profundizaremos en el uso de **Memoria en LangGraph**.  
Aprenderemos cómo usar `MemorySaver` para almacenar datos a lo largo de múltiples invocaciones, creando flujos de trabajo que recuerdan información pasada.  
